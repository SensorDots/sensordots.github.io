<!DOCTYPE html><html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# schema: http://schema.org/ sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema# ">
<!-- Mirrored from sensordots.org/firmwareguide by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 Aug 2022 12:25:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><meta charset="utf-8" /><meta name="description" content="Firmware Update Guide
The SensorDot boards can be easily programmed over I2C using the Multiboot Tool in the GitHub repository under Windows or Linux. This tool will reboot the selected SensorDot board into its firmware flashing bootloader which then allows you to re-program new firmware." /><meta name="keywords" content="SensorDots Sensor Dots Small Smart Simple Sensors Filtering Polling Crosstalk Automatic Address Addressing Bus Easy Processing" /><meta name="Generator" content="Drupal 8 (https://www.drupal.org)" /><meta name="MobileOptimized" content="width" /><meta name="HandheldFriendly" content="true" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="sites/default/files/favicon.ico" type="image/vnd.microsoft.icon" /><link rel="canonical" href="firmwareguide.html" /><link rel="shortlink" href="node/40.html" /><link rel="revision" href="firmwareguide.html" /><title>Firmware Update Guide | SensorDots</title><link rel="stylesheet" media="all" href="sites/default/files/css/css_RJqZCut1W0h7YRAwy_VGhC4L7Kaay-HAQBzYzaGiHNA.css" /><link rel="stylesheet" media="all" href="sites/default/files/css/css_TqP0rzTeinXkupgUr1mR41ebkMj_f9DCOzD1rEBC4ZY.css" /> <!--[if lte IE 8]><script src="/sites/default/files/js/js_VtafjXmRvoUgAzqzYTA3Wrjkx9wcWhjP0G4ZnnqRamA.js"></script><![endif]--></head><body class="path-node page-node-type-page"> <a href="#main-content" class="visually-hidden focusable skip-link"> Skip to main content </a><div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas> <header class="main-header"> <nav class="navbar navbar-default" role="navigation"><div class="container"><div class="row"><div class="navbar-header col-md-3"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><div class="region region-header"><div id="block-drupal8-zymphonies-theme-branding" class="site-branding block block-system block-system-branding-block"><div class="brand logo"> <a href="index.html" title="Home" rel="home" class="site-branding__logo"> <img src="sites/default/files/logo-big.png" alt="Home" /> </a></div></div></div></div><div class="col-md-9"><div class="region region-primary-menu"><div class="search-block-form block block-search" data-drupal-selector="search-block-form" id="block-drupal8-zymphonies-theme-search" role="search"><h2 class="visually-hidden">Search</h2><form action="http://sensordots.org/search/node" method="get" id="search-block-form" accept-charset="UTF-8"><div class="js-form-item form-item js-form-type-search form-item-keys js-form-item-keys form-no-label"> <label for="edit-keys" class="visually-hidden">Search</label> <input title="Enter the terms you wish to search for." data-drupal-selector="edit-keys" type="search" id="edit-keys" name="keys" value="" size="15" maxlength="128" class="form-search" /></div><div data-drupal-selector="edit-actions" class="form-actions js-form-wrapper form-wrapper" id="edit-actions"><input data-drupal-selector="edit-submit" type="submit" id="edit-submit" value="Search" class="button js-form-submit form-submit" /></div></form></div><nav role="navigation" aria-labelledby="block-drupal8-zymphonies-theme-main-menu-menu" id="block-drupal8-zymphonies-theme-main-menu"><h2 class="visually-hidden" id="block-drupal8-zymphonies-theme-main-menu-menu">Main navigation</h2><ul class="sm menu-base-theme" id="main-menu" class="menu nav navbar-nav"><li class="active"> <a href="index.html" data-drupal-link-system-path="&lt;front&gt;">Home</a></li><li> <a href="about.html" data-drupal-link-system-path="node/2">About</a></li><li> <a href="https://www.tindie.com/stores/blecky/">Store</a></li><li> <a href="dots.html" data-target="#" data-toggle="dropdown">Dots</a><ul><li> <a href="mappydot.html" data-drupal-link-system-path="node/3">MappyDot</a></li><li> <a href="mappydot_plus.html" data-drupal-link-system-path="node/32">MappyDot+</a></li></ul></li><li> <a href="tools.html" data-target="#" data-toggle="dropdown">Tools</a><ul><li> <a href="devboard.html" data-drupal-link-system-path="node/9">Dev Board</a></li><li> <a href="mounting_board.html">Mounting Board</a></li><li> <a href="port_multiplexer.html">Port MuxR</a></li></ul></li><li> <a href="docs.html">Docs</a></li><li> <a href="https://github.com/SensorDots">Repo</a></li><li> <a href="https://hackaday.io/project/25571-mappydot">Blog</a></li><li> <a href="custom.html">Custom Design</a></li></ul> </nav></div></div></div></div> </nav> </header><div class="container"><div class="row"><div class="col-md-12"><div class="region region-highlighted"><div data-drupal-messages-fallback class="hidden"></div></div></div></div></div><div id="wrapper"><div class="container"><div class="row"><div class="col-md-12"></div></div><div class="row layout"><div class="content_layout"><div class=col-md-12><div class="region region-content"><div id="block-drupal8-zymphonies-theme-content" class="block block-system block-system-main-block"> <article data-history-node-id="40" role="article" about="/firmwareguide" typeof="schema:WebPage" class="node node--type-page node--view-mode-full"> <span property="schema:name" content="Firmware Update Guide" class="hidden"></span><div class="node__content"><div property="schema:text"><h2>Firmware Update Guide</h2><p>The SensorDot boards can be easily programmed over I<sup>2</sup>C using the <a href="https://github.com/SensorDots/Programming/tree/master/I2C_Multiboot_Tool">Multiboot Tool</a> in the GitHub repository under Windows or Linux. This tool will reboot the selected SensorDot board into its firmware flashing bootloader which then allows you to re-program new firmware.</p><h3>Hardware Setup</h3><h4>USB Adapter</h4><p>Windows and Linux x86 platforms generally don't have easily accessible I<sup>2</sup>C peripherals, so to account for this, an Arduino/Teensy based USB to I<sup>2</sup>C adapter has been created to allow you to program SensorDots easily which works with a modified version of the Multiboot Tool (twiboot-arduino). This adapter is available in the repository <a href="https://github.com/SensorDots/Programming/tree/master/Arduino_I2C_Adapter">here</a>.</p><p>This adapter has been tested using the Teensy 3.1/3.2/3.5/3.6/LC, Arudino Nano and Arduino Uno. While every effort has been made to make it compatible with most Arduino boards, there might be compatibility issues with devices not listed here (especially if you are using a clone board). Please feel free to <a href="contact.html">contact us</a> if you are having issues with other boards. As a troubleshooting step, make sure that the board works with the generic <a href="https://playground.arduino.cc/Main/I2cScanner">I<sup>2</sup>C scanner demo</a>. Please note that we won't support clone boards as they can have numerous issues, however it generally should work with these if other I<sup>2</sup>C sketches work, with some slight driver tweaks (see Tips section down the bottom).</p><p>Load this sketch onto your Arduino board of choice using the Arduino IDE. For more information about programming Arduino sketches, please refer to the Arduino getting <a href="https://www.arduino.cc/en/Guide/HomePage">started guide</a>.</p><p>If you are using an Arudino based device, you might need to connect a <code>10μF</code> capacitor between the <code>Reset/RST</code> line and <code>GND</code> if the Arduino based board uses a DTR line to reset the Arduino for programming. This might depend on which operating system you are using (as you can disable DTR with stty in Linux), but it's the most reliable way of programming your SensorDot boards. There's more information here - <a href="https://playground.arduino.cc/Main/DisablingAutoResetOnSerialConnection">https://playground.arduino.cc/Main/DisablingAutoResetOnSerialConnection</a>. Teensy boards do not require this. Note you will need to remove the capacitor if you are wanting to program the Arduino again.</p><p><strong><u>UPDATE</u></strong>, there is now a -z flag in the twi-arduino executable that can be given which delays the I<sup>2</sup>C commands after opening the port, so you don't need to place a capacitor on the reset lines.</p><h4>Embedded Platforms</h4><p>As for embedded systems running Linux such as the Raspberry Pi with a built in I<sup>2</sup>C peripheral, you can directly use the /dev/i2cX device drivers built into most operating systems. You may need to enable I<sup>2</sup>C on these devices before they show up. On the Raspberry Pi, you can enable I<sup>2</sup>C with the following steps:</p><ol><li>Run <code>sudo raspi-config</code>.</li><li>Use the down arrow to select <code>Advanced Options</code></li><li>Arrow down to <code>I2C</code>.</li><li>Select <code>yes</code> when it asks you to enable I2C</li><li>Also select <code>yes</code> when it tasks about automatically loading the kernel module.</li><li>Use the right arrow to select the <code>&lt;Finish&gt;</code> button.</li><li>Select <code>yes</code> when it asks to reboot.</li></ol><p>Now that the the I<sup>2</sup>C peripheral or adapter is ready, you can now connect the I<sup>2</sup>C lines to the SensorDots I<sup>2</sup>C lines as per the <a href="gettingstarted.html">getting started guide</a>. Note, if you are already using an Arduino device to talk to your SensorDots boards, you can load the sketch onto this over the existing sketch. You can also load the adapter separately on the I<sup>2</sup>C bus as a second master device (just be sure to stop communications from other master on the bus).</p><h3>Windows</h3><p>Under Windows, you must use the Arduino based USB to I<sup>2</sup>C adapter, as Windows doesn't include I<sup>2</sup>C drivers that are compatible with the Multiboot Tool.</p><p>The <a href="https://github.com/SensorDots/Programming/tree/master/I2C_Multiboot_Tool">Multiboot sources</a> must be compiled under <a href="https://www.cygwin.com/">Cygwin</a> by running "make" in the source directory while in the Cygwin shell. There is a <a href="https://github.com/SensorDots/Programming/tree/master/I2C_Multiboot_Tool/cygwin-build">pre-built executable available</a> if you prefer not to perform this step (just download the <code>cygwin1.dll</code> and <code>twiboot-arduino.exe</code> files from GitHub and place in a directory of your choice).</p><p>Once you have the executable ready, place the correct SensorDot board firmware in the same directory as the exe (e.g. <code>MD_FW_V1.4.hex</code>). These firmware files are available in the Releases folder of the firmware of choice in the <a href="https://github.com/SensorDots">repository</a>.</p><img alt="Files" data-entity-type="file" data-entity-uuid="ca33ab03-300f-4ac7-bafd-7a971be61625" src="sites/default/files/inline-images/files.png" class="align-center" /><p>Next find the COM port number of the Arduino adapter. In Arduino this can be found by going to Tools&gt;Port:</p><img alt="Port" data-entity-type="file" data-entity-uuid="cebdd1e1-804c-4291-98fe-9e67feace85f" height="342" src="sites/default/files/inline-images/port.png" width="372" class="align-center" /><p>Browse to the <code>twiboot-adruino.exe</code> directory using the command prompt (Start&gt;Run&gt;cmd):</p><img alt="Command Prompt" data-entity-type="file" data-entity-uuid="6f883566-527d-47ff-9d17-3e7babf015dd" src="sites/default/files/inline-images/cmd.png" class="align-center" /><p>Now run the following command for COM4 to test everything is working, where the tty serial device number is the Windows COM number, minus 1 (e.g. for for <code>COM5</code> it's <code>/dev/ttyS4</code>). The -a flag indicates the SensorDot I<sup>2</sup>C address (0x08 is the first in the chain).</p><pre>
twiboot-arduino.exe -a 0x08 -d /dev/ttyS3</pre><p>If you get the error "error 22 from tcgetattr", open the COM port in a terminal application like Putty first (then close Putty), then run the command again.</p><p>You should get the following (and the SensorDot board LED should be rapidly flashing which indicates it is in bootloader mode):</p><img alt="Test Command" data-entity-type="file" data-entity-uuid="55f6a6a0-153c-4f1b-be63-b4c5f4660adf" src="sites/default/files/inline-images/test.png" class="align-center" /><p>Now you can run the firmware update routine:</p><pre>
twiboot-arduino.exe -a 0x08 -d /dev/ttyS3 -w flash:MD_FW_V1.4.hex</pre><img alt="Success" data-entity-type="file" data-entity-uuid="656ae768-2ccf-44b6-95bd-b5336bda3a5a" src="sites/default/files/inline-images/success.png" class="align-center" /><p>Once the firmware had flashed successfully, you can now reboot the SensorDot using the following command:</p><pre>
twiboot-arduino.exe -a 0x08 -d /dev/ttyS3 -s</pre><p>If you get a failure, please retry the firmware update routine:</p><img alt="Failed" data-entity-type="file" data-entity-uuid="3a98e9c4-3085-4cbf-a892-48795ae260ab" src="sites/default/files/inline-images/failed.png" class="align-center" /><h3>Linux</h3><p>The <a href="https://github.com/SensorDots/Programming/tree/master/I2C_Multiboot_Tool">Multiboot sources</a> must be compiled under Linux by running "make" in the source directory.</p><p>Once you have the executable ready, place the correct SensorDot board firmware in the same directory as the executable (e.g. <code>MD_FW_V1.5.hex</code>). These firmware files are available in the Releases folder of the firmware of choice in the <a href="https://github.com/SensorDots">repository</a>. Note there are two versions of the application here, <code>twiboot</code> and <code>twiboot-arduino</code>. The twiboot application is used when you have an embedded I2C peripheral on board and the twiboot-arduino version is used when you want to use the Arduino based USB to I<sup>2</sup>C adapter.</p><h4>Embedded Platforms</h4><p>Now there are two options to flashing the firmware under Linux. The first is if you are using an embedded system with I<sup>2</sup>C hardware. In this instance you simply run the following (where /dev/i2c-1 corresponds to your I<sup>2</sup>C device to make sure everything is working:</p><pre>
./twiboot -a 0x08 -d /dev/i2c-1</pre><p>You should get the following (and the SensorDot board LED should be rapidly flashing which indicates it is in bootloader mode):</p><img alt="Linux Run" data-entity-type="file" data-entity-uuid="28c9206f-d483-438e-b39e-56b9e8838db2" src="sites/default/files/inline-images/linuxrun.png" class="align-center" /><p>Now you can run the firmware update routine:</p><pre>
./twiboot -a 0x08 -d /dev/i2c-1 -w flash:MD_FW_V1.5.hex</pre><img alt="Linux Flash" data-entity-type="file" data-entity-uuid="a4dfca14-7776-4cbc-8c35-1fafe202a736" src="sites/default/files/inline-images/linuxflash.png" class="align-center" /><p>Once the firmware had flashed successfully, you can now reboot the SensorDot using the following command:</p><pre>
./twiboot -a 0x08 -d /dev/i2c-1 -s</pre><h4>USB Adapter</h4><p>The second option is to use the Arduino based USB to I<sup>2</sup>C adapter. First find the serial port device associated with the adapter using <code>dmesg | grep tty</code>:</p><img alt="Serial Linux" data-entity-type="file" data-entity-uuid="6c18c178-c9e4-499a-b61d-4dd24d1ad079" src="sites/default/files/inline-images/seriallinux.png" class="align-center" /><p>In this instance, the device is <code>/dev/ttyUSB0</code>. Now run the following to make sure everything is working:</p><pre>
sudo ./twiboot-arduino -a 0x08 -d /dev/ttyUSB0</pre><img alt="Linux Adapter" data-entity-type="file" data-entity-uuid="8cdf0c57-7972-4d4b-88f2-fa03eaea8b87" src="sites/default/files/inline-images/linuxadapter.png" class="align-center" /><p>Now you can run the firmware update routine:</p><pre>
./twiboot-arduino -a 0x08 -d /dev/ttyUSB0 -w flash:MD_FW_V1.5.hex</pre><p>Once the firmware had flashed successfully, you can now reboot the SensorDot using the following command:</p><pre>
./twiboot-arduino -a 0x08 -d /dev/ttyUSB0 -s</pre><h3>Tips and Recovery</h3><p>If you have more than one SensorDot board, you can now increment the I<sup>2</sup>C address in the command and program the next board in the chain. You must reset the previous SensorDot board before programming the next one in the chain.</p><p>It is recommended that you make sure each SensorDot board is successfully verified and boots correctly before moving onto the next device. If you batch script the programming and multiple boards fail to program correctly, or a power supply glitch restarts boards during programming, you may find a situation where you cannot get boards to enter the bootloader and some boards will no longer get their auto addressing.</p><p>There are a few options in this case, depending on the condition of the boards.</p><p>The first is applicable if one device has had an incorrect or badly modified firmware flashed and it still boots correctly, but it stops the rest of the devices in the chain from getting an address and it doesn't respond to commands itself. In this instance, just restart the affected board by pulling/shorting the RST pin to ground on that board before power up. Once pulled to ground, remove the short and run the <code>twiboot(-arduino) -a 0x07 -d /dev/ttyS3</code> command within 500ms, and the device should stay in bootloader mode (continuous rapid flashing). You can then perform the firmware update procedure once again.</p><p>In the instance where one or multiple boards are stuck in bootloader mode after a failed flashing and/or power glitch (continuous rapid flashing), you will need to hold the RST line on all affected SensorDot boards on the bus to ground before power up. Once pulled to ground, remove the short on one device and run the <code>twiboot(-arduino) -a 0x07 -d /dev/ttyS3</code> command within 500ms, and that device should stay in bootloader mode (continuous rapid flashing). You can then perform the firmware update procedure once again then reset the board (<code>twiboot-arduino.exe -a 0x07 -d /dev/ttyS3 -s</code>). Now run this for each of the other affected boards one by one.</p><p>If you get the error <code>failed to get chipinfo: No error</code> and you are using an Arudino clone using a fake FTDI chipset, you might have to set the Latency Timer to 1 in device manager under Windows. The baud rate should also be set to 115200. This is also useful if your device fails to verify on certain PCs.</p><img alt="Latency" data-entity-type="file" data-entity-uuid="978eb68a-14ff-440c-9cad-6a764cefb1ef" height="383" src="sites/default/files/inline-images/latency_0.png" width="880" class="align-center" /><p> </p></div></div></article></div></div></div></div></div></div></div><div class="footer-menu"><div class="container"><div class="row"><div class="col-sm-6 col-md-6"><div class="region region-footer-menu"> <nav role="navigation" aria-labelledby="block-drupal8-zymphonies-theme-footer-menu" id="block-drupal8-zymphonies-theme-footer"><h2 class="visually-hidden" id="block-drupal8-zymphonies-theme-footer-menu">Footer menu</h2><ul class="menu"><li class="menu-item"> <a href="contact.html" data-drupal-link-system-path="contact">Contact</a></li><li class="menu-item"> <a href="disclaimers.html">Disclaimers</a></li><li class="menu-item"> <a href="news.html">News</a></li><li class="menu-item"> <a href="privacy.html">Privacy Policy</a></li><li class="menu-item"> <a href="newsletter/subscriptions.html" data-drupal-link-system-path="newsletter/subscriptions">Subscriptions</a></li></ul> </nav></div></div><div class="col-sm-6 col-md-6"><div class="social-media"> <a href="https://twitter.com/sensordots" class="twitter" target="_blank" ><i class="fab fa-twitter"></i></a> <a href="https://www.linkedin.com/company/18254750/" class="linkedin" target="_blank"><i class="fab fa-linkedin-in"></i></a></div></div></div></div></div><div class="copyright"><div class="container"><div class="row"><div class="col-sm-6 col-md-6"><p>Copyright © SensorDots 2020</p></div></div></div></div></div><script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"node\/40","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","suppressDeprecationErrors":true,"ajaxPageState":{"libraries":"classy\/node,colorbox\/default,colorbox_inline\/colorbox_inline,core\/html5shiv,drupal8_zymphonies_theme\/bootstrap,drupal8_zymphonies_theme\/flexslider,drupal8_zymphonies_theme\/fontawesome,drupal8_zymphonies_theme\/global-components,drupal8_zymphonies_theme\/smartmenus,system\/base","theme":"drupal8_zymphonies_theme","theme_token":null},"ajaxTrustedUrl":{"\/search\/node":true},"colorbox":{"transition":"elastic","speed":350,"opacity":0.8000000000000000444089209850062616169452667236328125,"slideshow":false,"slideshowAuto":true,"slideshowSpeed":2500,"slideshowStart":"start slideshow","slideshowStop":"stop slideshow","current":"{current} of {total}","previous":"\u00ab Prev","next":"Next \u00bb","close":"Close","overlayClose":true,"returnFocus":true,"maxWidth":"80%","maxHeight":"80%","initialWidth":"300","initialHeight":"250","fixed":true,"scrolling":true,"mobiledetect":true,"mobiledevicewidth":"480px"},"user":{"uid":0,"permissionsHash":"e3ab66e5440975c4c1130bb59a86f381def0e44af11e4b8bc2031e564626f57f"}}</script><script src="../ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="sites/default/files/js/js_z8MKdK9rPFI4grt3IiJcmfRC3e2SqIgyx3dIX8GONAo.js"></script></body>
<!-- Mirrored from sensordots.org/firmwareguide by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 Aug 2022 12:25:10 GMT -->
</html>